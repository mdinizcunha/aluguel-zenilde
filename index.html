<script>
  async function gerarPDF() {
    const data = {
      nome: document.getElementById("nome").value,
      cpf: document.getElementById("cpf").value,
      endereco: document.getElementById("endereco").value,
      valor: document.getElementById("valor").value,
      inicio: document.getElementById("inicio").value,
      finalidade: document.getElementById("finalidade").value,
      prazo: document.getElementById("prazo").value,
      percentual: document.getElementById("percentual").value,
    };

    const res = await fetch("/api/gerar-pdf", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    const json = await res.json();

    if (!json.body) {
      alert("Erro ao gerar PDF!");
      return;
    }

    // converte base64 → bytes → Blob
    const base64 = json.body;
    const binaryString = atob(base64);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    const blob = new Blob([bytes], { type: "application/pdf" });

    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "contrato.pdf";
    document.body.appendChild(a);
    a.click();
    a.remove();
    window.URL.revokeObjectURL(url);
  }
</script>
